---
title: "Vota Unicamp!"
author: Ana Flávia Polisel, Bruna Mendes Heyn, Eliane Ramos de Siqueira, Gustavo Cordeiro,
  Michely Wu Hsieh e Natalia Rodrigues da Silva
output: html_document
---

###Introdução  e objetivo
    As universidades estaduais paulistas tem vivido momentos de grande tensão desde que teve inicio uma greve geral dos estudantes que têm como objetivo revindicar pautas como a implementação de cotas etnico-raciais, a ampliação da moradia estudantil e a negociação a respeito dos cortes orçamentarios anunciados pelo governo do estado. Desde o dia 10/05 as intalações da reitoria e da pró-reitoria das UNICAMP foram ocupadas por estudantes e assim permanecem a atual data, mesmo após mandados judiciais de desocupação e ameaças de reintegrção de posse por parte da Policia Militar.
    Além do movimento geral de greve e da ocupação existem movimentos grevistas dentro de cada um dos institutos. A decisão a respeito do apoio, ou não a greve nessa instância é, então, feita através de assembléias, que são reuniões organizadas pelo centro acadêmico de cada instituto, os quais são formados por alunos do mesmo.
    O problema começa quando estudantes e docentes passam a questionar a representatibilidade das assembléias já que, devido as atividades e cronogramas acadêmicos a serem cumpridos, muitos dos estudantes contrários a greve não abrem mão de seus afazeres para comparecerem a tais reuniões, o que faz com que estas contem com um número reduzido de alunos que, em sua maioria, votam a favor.
    Diante desse problema o site "votaunicamp" foi criado com a intenção de conhecer a verdadeira opinião dos estudantes da universidade Estadual de Campinas em relação a pauta da greve estudantil através de uma votação online. A metodologia do site é segura por permitir que cada aluno vote uma unica vez, descartando, então, o risco de que a votação seja fraudada. Na pesquisa os votos são classificados em: "Sim","Não","Abstenção". Além disso, os alunos podem justificar seus votos. 
    O projeto final de ME524 tem como objetivo fazer uma análise descritiva dos dados presentes no site "votaunicamp". Para fazer tal estudo utilizaremos como ferramentas gráficos e tabelas obtidos a partir dos dados presentes no site.

```{r input, message=FALSE, echo=FALSE}
## Setup
Sys.setlocale(locale='UTF-8')
library(stringr)
library(rvest)
library(googleVis)
library(leaflet)
library(pracma)
page = read_html('https://votaunicamp.herokuapp.com/prev_results/', encoding='UTF-8')
tbl = html_table(page)[[2]]
names(tbl)=c("Curso","Total","Sim","Abstenções","Não")
tbl$Curso=repair_encoding(tbl$Curso)
#head(tbl)
```

```{r format, echo=FALSE}
## Formatação de Dados
mytbl = data.frame(codigo=as.integer(str_extract(tbl$Curso, "^\\d+")),
nivel=NA,
curso=gsub("^(\\d+) - (.*)$", "\\2", tbl$Curso),
total=tbl$Total,
sim=as.integer(str_extract(tbl$Sim, "^\\d+")),
nao=as.integer(str_extract(tbl$Não, "^\\d+")),
abstencao=as.integer(str_extract(tbl$Abstenções, "^\\d+")))
nivel = str_extract(mytbl$curso, "(Dou|Mes)[a-z]+")
nivel[grepl("Mes", nivel)] = "Mestrado"
nivel[grepl("Dou", nivel)] = "Doutorado"
nivel[is.na(nivel)] = "Graduacao"
mytbl$nivel = nivel
rm(nivel)
mytbl$curso = gsub("(Mes|Dou).+ em (.*)$", "\\2", mytbl$curso)
#head(mytbl)
```

##Tabela de Dados Original

Essa tabela apresenta todos os dados presentes no site dividos em sete categorias: 
Código do curso, nível do curso, nome do curso, total de votos, número de sim, número de não e número de abstenção.

```{r tabela de dados, echo=FALSE}
library(DT)
datatable(mytbl, options = list(pageLength = 10))
```

##Formatação dos dados

##Análises para Graduação

```{r separacao_areas, echo=FALSE}
library(dplyr)
graduacao=filter(mytbl, nivel=="Graduacao")
#*#ARTES,
artes=filter(graduacao,codigo=="26"|codigo=="25"|codigo=="64"|codigo=="23"|codigo=="22")
#*#PROGRAMAS, ESPECIAIS
pespeciais=filter(graduacao,codigo=="200")
#*#BIOLOGICAS,
biologicas=filter(graduacao,codigo=="6"|codigo=="100"|codigo=="27"|codigo=="45"|codigo=="21"|codigo=="63"|codigo=="58"|codigo=="46"|codigo=="15"|codigo=="107"|codigo=="14")
#*#HUMANAS,
humanas=filter(graduacao,codigo=="109"| codigo=="110"| codigo=="17"| codigo=="47"| codigo=="16"|codigo=="44"| codigo=="75"|codigo=="30"| codigo=="54"| codigo=="55"|codigo=="19"|codigo=="7"|codigo=="57"|codigo=="56"|codigo=="18"|codigo=="20"|codigo=="38")
##*EXATAS,
exatas=filter(graduacao,codigo=="48"|codigo=="42"|codigo=="36"|codigo=="83"|codigo=="73"|codigo=="87"|codigo=="8"|codigo=="89"|codigo=="12"|codigo=="13"|codigo=="43"|codigo=="34"|codigo=="49"|codigo=="101"|codigo=="102"|codigo=="88"|codigo=="11"|codigo=="41"|codigo=="108"|codigo=="10"|codigo=="9"|codigo=="39"|codigo=="2"|codigo=="4"|codigo=="53"|codigo=="40"|codigo=="29"|codigo=="1"|codigo=="28"|codigo=="51"|codigo=="5"|codigo=="50"|codigo=="94")
```

```{r separando os institutos, echo=FALSE}
library(dplyr)
IMECC = filter(graduacao,codigo=="1"|codigo=="2"|codigo=="28"|codigo=="29"|codigo=="51"|codigo=="31"|codigo=="79")
FEM = filter(graduacao,codigo=="10"|codigo=="49"|codigo=="98"|codigo=='60'|codigo=='92'|codigo=='72'|codigo=="39")
FCA = filter(graduacao,codigo=="100"|codigo=="107"|codigo=="101"|codigo=="102"|codigo=="33"|codigo=="54"|codigo=="91"|codigo=="52")
IFGW = filter(graduacao,codigo=="4"|codigo=="108"|codigo=="40"|codigo=="54")
IFCH = filter(graduacao,codigo=="19"|codigo=="30"|codigo=="44"|codigo=="16"|codigo=="28"|codigo=="25"|codigo=="66"|codigo=="94"|codigo=="74"|codigo=="69"|codigo=="103"|codigo=="27"|codigo=="36"|codigo=="37"|codigo=="75"|codigo=="24"|codigo=="80"|codigo=="38")
FEEC = filter(graduacao,codigo=="11"|codigo=="41"|codigo=="34"|codigo=="61")
FEC = filter(graduacao,codigo=="12"|codigo=="32"|codigo=="62"|codigo=="89")
FOP = filter(graduacao,codigo=="14"|codigo=="16"|codigo=="73"|codigo=="20"|codigo=="19"|codigo=="64"|codigo=="18"|codigo=="67"|codigo=="23"|codigo=="71"|codigo=="70"|codigo=="69")
FEA = filter(graduacao,codigo=="13"|codigo=="43"|codigo=="81"|codigo=="34"|codigo=="6"|codigo=="7"|codigo=="5"|codigo=="47"|codigo=="56"|codigo=="57"|codigo=="55")
FCM = filter(graduacao,codigo=="15"|codigo=="21"|codigo=="58"|codigo=="89"|codigo=="8"|codigo=="75"|codigo=="97"|codigo=="23"|codigo=="104"|codigo=="90"|codigo=="87"|codigo=="36"|codigo=="91"|codigo=="100"|codigo=="49"|codigo=="58"|codigo=="35"|codigo=="42"|codigo=="74"|codigo=="50"|codigo=="44"|codigo=="90"|codigo=="48"|codigo=="59")
IE = filter(graduacao,codigo=="17"|codigo=="47"|codigo=="21"|codigo=="67"|codigo=="53")
IEL = filter(graduacao,codigo=="7"|codigo=="57"|codigo=="18"|codigo=="75"|codigo=="68"|codigo=="93"|codigo=="57"|codigo=="81"|codigo=="40")
IA = filter(graduacao,codigo=="26"|codigo=="25"|codigo=="64"|codigo=="23"|codigo=="22"|codigo=="105"|codigo=="106"|codigo=="2"|codigo=="22"|codigo=="83"|codigo=="65"|codigo=="61"|codigo=="60"|codigo=="63"|codigo=="62")
FEF =filter(graduacao,codigo=="27"|codigo=="45"|codigo=="78"|codigo=="28")
IC= filter(graduacao,codigo=="42"|codigo=="53"|codigo=="3"|codigo=="35")
FEQ = filter(graduacao,codigo=="39"|codigo=="9"|codigo=="59")
IB = filter(graduacao,codigo=="6"|codigo=="46"|codigo=="101"|codigo=="14"|codigo=="10"|codigo=="9"|codigo=="12"|codigo=="13"|codigo=="11")
IQ = filter(graduacao, codigo=="5"|codigo=="50"|codigo=="55")
IG = filter(graduacao,codigo=="53"|codigo=="54"|codigo=="55"|codigo=="26"|codigo=="76"|codigo=="24"|codigo=="95"|codigo=="79"|codigo=="41")
FEAGRI = filter(graduacao, codigo=="8"|codigo=="58")
FE = filter(graduacao,codigo=="20"|codigo=="38"|codigo=="70"|codigo=="102"|codigo=="86")
PROFIS = filter(graduacao, codigo=="200")

```

```{r adicionando novas colunas, echo=FALSE}
#*#adicionando coluna de área
library(dplyr)
exatas<-mutate(exatas,Area="Exatas")
biologicas<-mutate(biologicas,Area="Biológicas")
humanas<-mutate(humanas,Area="Humanas")
artes<-mutate(artes,Area="Artes")
pespeciais<-mutate(pespeciais,Area="Programas Especiais")

tabelageral=rbind(exatas,biologicas,humanas,artes,pespeciais)

##adicionando coluna instituto
IMECC<-mutate(IMECC,Instituto="IMECC")
FEM<-mutate(FEM,Instituto="FEM")
FCA<-mutate(FCA,Instituto="IMECC")
IFGW<-mutate(IFGW,Instituto="IFGW")
IFCH<-mutate(IFCH,Instituto="IFCH")
FEEC<-mutate(FEEC,Instituto="FEEC")
FEC<-mutate(FEC,Instituto="FEC")
FOP<-mutate(FOP,Instituto="FOP")
FEA<-mutate(FEA,Instituto="FEA")
FCM<-mutate(FCM,Instituto="FCM")
IE<-mutate(IE,Instituto="IE")
IA<-mutate(IA,Instituto="IEL")
FEF<-mutate(FEF,Instituto="FEF")
IC<-mutate(IC,Instituto="IC")
FEQ<-mutate(FEQ,Instituto="FEQ")
IB<-mutate(IB,Instituto="IB")
IQ<-mutate(IQ,Instituto="IQ")
IG<-mutate(IG,Instituto="IG")
FEAGRI<-mutate(FEAGRI,Instituto="FEAGRI")
FE<-mutate(FE,Instituto="FE")
PROFIS<-mutate(PROFIS,Instituto="PROFIS")

tabelageral=rbind(IMECC,FCA,IFGW,IFCH,FEEC,FEC,FOP,FEA,FCM,IE,IA,FEF,IC,FEQ,IB,IQ,IG,FEAGRI,FE,PROFIS)

#*#Adicionando, uma coluna de proporção de sim e outra de não
tabelageral<-mutate(tabelageral,"Proporção de Sim"=(tabelageral$sim/tabelageral$total))
tabelageral<-mutate(tabelageral,"Proporção de Não"=(tabelageral$nao/tabelageral$total))

##Exibindo a tabela geral
library(DT)
datatable(tabelageral, options = list(pageLength = 10))

```

#Análise dos Totais de votos

###Gráficos de Barras por Áreas
Primeiramente, graficamos os dados por área para melhor visualização. O objetivo é saber se a área do curso de cada aluno que respondeu a pesquisa influencia na sua opinião a respeito da greve.


####Exatas
```{r,, echo=FALSE}
barplot(c(sum(exatas$sim),sum(exatas$nao),sum(exatas$abstencao)),legend=colnames(exatas[5:7]),col=c("gray","darkblue","lightblue"),main="Votos de exatas")
```

####Humanas
```{r, echo=FALSE}
barplot(c(sum(humanas$sim),sum(humanas$nao),sum(humanas$abstencao)),legend=colnames(humanas[5:7]),col=c("gray","darkblue","lightblue"),main="Votos de humanas")
```

####Biológicas
```{r, echo=FALSE}
barplot(c(sum(biologicas$sim),sum(biologicas$nao),sum(biologicas$abstencao)),legend=colnames(biologicas[5:7]),col=c("gray","darkblue","lightblue"),main="Votos de biológicas")
```

####Artes
```{r, echo=FALSE}
barplot(c(sum(artes$sim),sum(artes$nao),sum(artes$abstencao)),legend=colnames(artes[5:7]),col=c("gray","darkblue","lightblue"),main="Votos de artes")
```

####Programas Especiais
```{r, echo=FALSE}
barplot(c(sum(pespeciais$sim),sum(pespeciais$nao),sum(pespeciais$abstencao)),legend=colnames(pespeciais[5:7]),col=c("gray","darkblue","lightblue"),main="Votos de programas especiais")
```

Analisando os gráficos é possível perceber que em geral, as áreas de exatas, biológicas e programas especiais são contra a greve, no entanto, as áreas de humanas e artes se mostram a favor da greve. #calcular a proporção e analisar qual é maior.

##Gráfico do Total de Votos da Graduação

O gráfico abaixo mostra o total de votos dos alunos da gradução.

```{r, echo=FALSE}
barplot(c(sum(graduacao$sim),sum(graduacao$nao),sum(graduacao$abstencao)),legend=colnames(graduacao[5:7]),col=c("gray","darkblue","lightblue"))
```

Comparando o gráfico total de votos da graduação com cada área, concluimos que a proporção de votos contrários a greve ainda é maior. 

##Análise de Proporções

####Proporções por Área

```{r}
##fazer grafico de pizza
```


####Proporções por Instituto

```{r}
##fazer grafico de pizza
```

##Separação por áreas na pós-graduação
Apesar da greve estudantil ser articulada pelos estudantes da graduação, achamos válido fazer uma análise dos estudantes da pós-graduação, separados em Mestrado e Doutorado para saber se a opinião destes é semelhante à dos alunos da graduação em suas respectivas áreas, levando em conta que o movimento estudantil tem ganhado força e, com isso, interfere também em suas vidas acadêmicas.

#Análises para Mestrado

Primeiramente, faremos análises do Mestrado.
```{r, echo=FALSE}

library(dplyr)
mestrado=filter(mytbl, nivel=="Mestrado")

##ARTES
artesm=filter(mestrado,codigo=="87"|codigo=="88"|codigo=="30"|codigo=="73")
##HUMANAS
humanasm=filter(mestrado,codigo=="20"|codigo=="86"|codigo=="53"|codigo=="17"|codigo=="81"|codigo=="18"|codigo=="40"|codigo=="7"|codigo=="36"|codigo=="37"|codigo=="75"|codigo=="24"|codigo=="19"|codigo=="80"|codigo=="38"|codigo=="54"|codigo=="26"|codigo=="79"|codigo=="41")
##BIOLÓGICAS
biologicasm=filter(mestrado,codigo=="84"|codigo=="91"|codigo=="92"|codigo=="49"|codigo=="58"|codigo=="35"|codigo=="42"|codigo=="74"|codigo=="51"|codigo=="50"|codigo=="44"|codigo=="90"|codigo=="48"|codigo=="28"|codigo=="59"|codigo=="67"|codigo=="23"|codigo=="71"|codigo=="70"|codigo=="14"|codigo=="69"|codigo=="83"|codigo=="65"|codigo=="61"|codigo=="60"|codigo=="63"|codigo=="64"|codigo=="62")
##EXATAS
exatasm=filter(mestrado,codigo=="47"|codigo=="56"|codigo=="57"|codigo=="55"|codigo=="8"|codigo=="89"|codigo=="12"|codigo=="11"|codigo=="72"|codigo=="10"|codigo=="39"|codigo=="9"|codigo=="82"|codigo=="3"|codigo=="4"|codigo=="2"|codigo=="1"|codigo=="29"|codigo=="5")

```

```{r sepando por instituto}
##colocarm na frente
```


```{r}
#*#criandonovacoluna com areas

library(dplyr)
exatasm<-mutate(exatasm,Area="Exatas")
biologicasm<-mutate(biologicasm,Area="Biológicas")
humanasm<-mutate(humanasm,Area="Humanas")
artesm<-mutate(artesm,Area="Artes")
tabelageralm=rbind(exatasm,biologicasm,humanasm,artesm)

##adicionando coluna instituto
IMECCm<-mutate(IMECCm,Instituto="IMECC")
FEMm<-mutate(FEMm,Instituto="FEM")
FCAm<-mutate(FCAm,Instituto="IMECC")
IFGWm<-mutate(IFGWm,Instituto="IFGW")
IFCHm<-mutate(IFCHm,Instituto="IFCH")
FEECm<-mutate(FEECm,Instituto="FEEC")
FECm<-mutate(FECm,Instituto="FEC")
FOPm<-mutate(FOPm,Instituto="FOP")
FEAm<-mutate(FEAm,Instituto="FEA")
FCMm<-mutate(FCMm,Instituto="FCM")
IEm<-mutate(IEm,Instituto="IE")
IAm<-mutate(IAm,Instituto="IEL")
FEFm<-mutate(FEFm,Instituto="FEF")
ICm<-mutate(ICm,Instituto="IC")
FEQm<-mutate(FEQm,Instituto="FEQ")
IBm<-mutate(IBm,Instituto="IB")
IQm<-mutate(IQm,Instituto="IQ")
IGm<-mutate(IGm,Instituto="IG")
FEAGRIm<-mutate(FEAGRIm,Instituto="FEAGRI")
FEm<-mutate(FEm,Instituto="FE")

tabelageralm=rbind(IMECCm,FCAm,IFGWm,IFCHm,FEECm,FECm,FOPm,FEAm,FCMm,IEm,IAm,FEFm,ICm,FEQm,IBm,IQm,IGm,FEAGRIm,FEm)

#*#Adicionando, uma coluna de proporção de sim e outra de não
tabelageralm<-mutate(tabelageralm,"Proporção de Sim"=(tabelageralm  $sim/tabelageralm$total))
tabelageralm<-mutate(tabelageralm,"Proporção de Não"=(tabelageralm$nao/tabelageralm$total))

##Exibindo a tabela geral mestrado
library(DT)
datatable(tabelageralm, options = list(pageLength = 10))
```

#Análise dos Totais de votos

###Gráficos de Barras por Áreas

##Exatas
```{r, echo=FALSE }
barplot(c(sum(exatasm$sim),sum(exatasm$nao),sum(exatasm$abstencao)),legend=colnames(exatasm[5:7]),col=c("gray","darkblue","lightblue"))
```

##Humanas
```{r, echo=FALSE }
barplot(c(sum(humanasm$sim),sum(humanasm$nao),sum(humanasm$abstencao)),legend=colnames(humanasm[5:7]),col=c("gray","darkblue","lightblue"))
```

##Biológicas
```{r, echo=FALSE }
barplot(c(sum(biologicasm$sim),sum(biologicasm$nao),sum(biologicasm$abstencao)),legend=colnames(biologicasm[5:7]),col=c("gray","darkblue","lightblue"))
```

##Artes
```{r, echo=FALSE }
barplot(c(sum(artesm$sim),sum(artesm$nao),sum(artesm$abstencao)),legend=colnames(artesm[5:7]),col=c("gray","darkblue","lightblue"))
```

##Grafico do Total de Votos do Mestrado
```{r, echo=FALSE}
barplot(c(sum(mestrado$sim),sum(mestrado$nao),sum(mestrado$abstencao)),legend=colnames(mestrado[5:7]),col=c("gray","darkblue","lightblue"))
```

Como o tamanho da amostra de votos do mestrado é pequeno, não podemos ter respostas certeiras sobre a opinião destas pessoas, contudo os resultados tendem a serem similares com os alunos da graduação.

##Análise de Proporções

####Proporções por Área

####Proporções por Instituto


#Análises para Doutorado

```{r separação por areas, echo=FALSE}
library(dplyr)
doutorado=filter(mytbl, nivel=="Doutorado")

##ARTES
artesd=filter(doutorado,codigo=="105"|codigo=="106"|codigo=="2"|codigo=="22")
##HUMANAS
humanasd=filter(doutorado,codigo=="21"|codigo=="67"|codigo=="67"|codigo=="68"|codigo=="93"|codigo=="57"||codigo=="28"|codigo=="25"|codigo=="30"|codigo=="66"|codigo=="94"|codigo=="74"|codigo=="69"|codigo=="103"|codigo=="27"|codigo=="26"|codigo=="76"|codigo=="24"|codigo=="95"|codigo=="70"|codigo=="102")
##BIOLÓGICAS
biologicasd=filter(doutorado,codigo=="33"|codigo=="89"|codigo=="8"|codigo=="75"|codigo=="97"|codigo=="23"|codigo=="104"|codigo=="90"|codigo=="87"|codigo=="36"|codigo=="91"|codigo=="78"|codigo=="100"|codigo=="16"|codigo=="73"|codigo=="20"|codigo=="19"|codigo=="64"|codigo=="18"|codigo=="101"|codigo=="14"|codigo=="10"|codigo=="9"|codigo=="12"|codigo=="13"|codigo=="11")
##EXATAS
exatasd=filter(doutorado,codigo=="81"|codigo=="34"|codigo=="6"|codigo=="7"|codigo=="5"|codigo=="58"|codigo=="32"|codigo=="62"|codigo=="61"|codigo=="98"|codigo=="60"|codigo=="92"|codigo=="59"|codigo=="35"|codigo=="53"|codigo=="54"|codigo=="31"|codigo=="51"|codigo=="79"|codigo=="55")
```

```{r separação por institutos}

```

```{r criando nova coluna areas, echo=FALSE}
##criandonovacoluna
library(dplyr)
exatasd<-mutate(exatasd,Area="Exatas")
biologicasd<-mutate(biologicasd,Area="Biológicas")
humanasd<-mutate(humanasd,Area="Humanas")
artesd<-mutate(artesd,Area="Artes")
tabelagerald=rbind(exatasd,biologicasd,humanasd,artesd)

##adicionando coluna instituto
IMECCd<-mutate(IMECCd,Instituto="IMECC")
FEMd<-mutate(FEMd,Instituto="FEM")
FCAd<-mutate(FCAd,Instituto="IMECC")
IFGWd<-mutate(IFGWd,Instituto="IFGW")
IFCHd<-mutate(IFCHd,Instituto="IFCH")
FEECd<-mutate(FEECd,Instituto="FEEC")
FECd<-mutate(FECd,Instituto="FEC")
FOPd<-mutate(FOPd,Instituto="FOP")
FEAd<-mutate(FEAd,Instituto="FEA")
FCMd<-mutate(FCMd,Instituto="FCM")
IEd<-mutate(IEd,Instituto="IE")
IAd<-mutate(IAd,Instituto="IEL")
FEFd<-mutate(FEFd,Instituto="FEF")
ICd<-mutate(ICd,Instituto="IC")
FEQd<-mutate(FEQd,Instituto="FEQ")
IBd<-mutate(IBd,Instituto="IB")
IQd<-mutate(IQd,Instituto="IQ")
IGd<-mutate(IGd,Instituto="IG")
FEAGRId<-mutate(FEAGRId,Instituto="FEAGRI")
FEd<-mutate(FEd,Instituto="FE")


tabelagerald=rbind(IMECCd,FCAd,IFGWd,IFCHd,FEECd,FECd,FOPd,FEAd,FCMd,IEd,IAd,FEFd,ICd,FEQd,IBd,IQd,IGd,FEAGRId,FEd,PROFISd)

##criando novas colunas com proporções
tabelagerald<-mutate(tabelagerald,"Proporção de Sim"=(tabelagerald$sim/tabelagerald$total))
tabelagerald<-mutate(tabelagerald,"Proporção de Não"=(tabelagerald$nao/tabelagerald$total))

library(DT)
datatable(tabelagerald, options = list(pageLength = 10))
```

##Análise de Proporções

####Proporções por Área

####Proporções por Instituto




## Gauge Plots

```{r plot_gauge}
tbl0 = subset(mytbl, nivel=='Graduacao')
tbl0$pnao = round(tbl0$nao/tbl0$total*100, 0)
gauge = gvisGauge(tbl0[, c('curso', 'pnao')], 'curso', 'nao',
                  options=list(min=0, max=100, greenFrom=0,
                                 greenTo=20, yellowFrom=40, yellowTo=60,
                                 redFrom=80, redTo=100, width=400, height=300))
plot(gauge)
```

## Obtenção de Dados Geográficos

Obter localizações (lat/lon) por meio do OpenStreet Maps:

- Abrir OpenStreet Maps (OSM) em (http://www.openstreetmap.org/#map=16/-22.8173/-47.0677)
- Dar zoom máximo no instituto de interesse
- Olhar o endereço na barra de endereço após o zoom
- Atualizar o arquivo `institutos.tab` (separado por tabulações) abaixo com as novas informações

```{r enderecos}
ends = read.table('institutos.tab', sep='\t', header=TRUE)
map = leaflet()
map = addTiles(map)
map = addCircleMarkers(map, lat=ends$lat, lng=ends$lon, popup = ends$instituto)
map
```

## Intervalos de Confiança

```{r stats}
p = with(mytbl, nao/(total))
mes = qnorm(.975)*sqrt(1/(4*mytbl$total))
ics = cbind(pmax(p-mes, 0), pmin(p+mes, 1))
colnames(ics) = c("lower", "upper")
mytbl$p = p
mytbl = cbind(mytbl, ics)
```
